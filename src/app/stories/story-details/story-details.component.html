<div *ngIf="story$ | async as story" class="story-details-container">

  <!-- Sticky Toolbar -->
  <div class="story-toolbar">
    <a mat-mini-fab color="accent" routerLink="/stories" aria-label="Back to stories list">
      <mat-icon>arrow_back</mat-icon>
    </a>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <img *ngIf="story.heroImage?.sizes?.thumbnail?.url"
         [src]="story.heroImage.sizes.thumbnail.url | payloadMedia"
         [alt]="story.heroImage.alt"
         class="breadcrumb-thumbnail">
    <span class="breadcrumb-title" [matTooltip]="story.title">{{ story.title }}</span>
  </div>

  <!-- Story Content Card -->
  <mat-card class="story-card">
    <img mat-card-image *ngIf="story.heroImage" [src]="story.heroImage.sizes.full.url | payloadMedia" [alt]="story.heroImage.alt" class="hero-image">

    <mat-card-header>
      <mat-card-title class="story-title">
        {{ story.title }}
      </mat-card-title>
      <mat-card-subtitle>
        <div class="story-meta">
          <div *ngIf="story.authors && story.authors.length > 0" class="author-info">
            <img [src]="story.authors[0].avatar.sizes.square.url | payloadMedia" [alt]="story.authors[0].avatar.alt" class="author-avatar">
            <span>{{ story.authors[0].firstName }} {{ story.authors[0].lastName }}</span>
          </div>
          <span *ngIf="story.publishedDate" class="published-date">{{ story.publishedDate | date }}</span>
          <span *ngIf="story.readingTime" class="reading-time">{{ story.readingTime }} min read</span>
        </div>
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="story.tags && story.tags.length > 0" class="story-tags">
        <span *ngFor="let tag of story.tags" class="tag-chip">{{ tag.name }}</span>
      </div>
      <div *ngIf="story.subtitle" class="story-subtitle">
        <div *ngFor="let block of story.subtitle">
          <ng-container [ngSwitch]="block.__typename">
            <p *ngSwitchCase="'Text'">{{ block.text }}</p>
            <blockquote *ngSwitchCase="'Blockquote'">
              <p>{{ block.quote }}</p>
              <cite>{{ block.citation }}</cite>
            </blockquote>
          </ng-container>
        </div>
      </div>

      <div *ngIf="story.content" class="story-content">
        <pre>{{ story.content | json }}</pre>
      </div>

      <div *ngIf="story.chapters && story.chapters.length > 0" class="story-chapters">
        <h2>Chapters</h2>
        <div class="chapter-list">
          <mat-card *ngFor="let chapter of story.chapters" class="chapter-card">
            <a [routerLink]="['/story', chapter.slug]">
              <img [src]="chapter.heroImage.sizes.card.url | payloadMedia" [alt]="chapter.heroImage.alt" class="chapter-image">
              <div class="chapter-overlay">
                <h3 class="chapter-title">{{ chapter.title }}</h3>
              </div>
            </a>
          </mat-card>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

</div>
